<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="Petly.Maui.Views.MapPage"
    x:Name="MapPageRoot"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:Petly.Maui.Controls"
    xmlns:local="clr-namespace:Petly.Maui"
    Title="ÐœÐ°Ð¿Ð°"
    BackgroundColor="#FFFFFBF7">

    <!-- Ð Ð•Ð¡Ð£Ð Ð¡Ð˜ -->
    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Ð¢Ð£Ð¢ ÐÐ• ÐŸÐžÐ’Ð˜ÐÐÐž Ð‘Ð£Ð¢Ð˜ 'clr-namespace:' Ñƒ Ñ‚ÐµÐ³Ñ–! -->
            <local:EqualityConverter x:Key="EqualityConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>


    <Grid RowDefinitions="Auto,*" Background="{DynamicResource Theme_BackgroundBrush}">
        <!-- TOP BAR -->
        <controls:TopNavBar />

        <!-- ÐžÐ¡ÐÐžÐ’ÐÐ Ð§ÐÐ¡Ð¢Ð˜ÐÐ -->
        <Grid Grid.Row="1" Padding="16" ColumnDefinitions="280,*" ColumnSpacing="16">

            <!-- Ð›Ñ–Ð²Ð° Ð¿Ð°Ð½ÐµÐ»ÑŒ: Ñ„Ð¾Ñ€Ð¼Ð° (Ð´Ð»Ñ Ð°Ð´Ð¼Ñ–Ð½Ð°) + ÑÐ¿Ð¸ÑÐ¾Ðº -->
            <ScrollView Grid.Column="0">
                <VerticalStackLayout Spacing="12">

                    <!-- Ð¤Ð¾Ñ€Ð¼Ð° Ð´Ð¾Ð´Ð°Ð²Ð°Ð½Ð½Ñ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ñ€Ð¸Ñ‚ÑƒÐ»ÐºÑƒ (Ð²Ð¸Ð´Ð½Ð¾ Ð»Ð¸ÑˆÐµ Ð°Ð´Ð¼Ñ–Ð½Ð°Ð¼) -->
                    <VerticalStackLayout x:Name="AdminForm" Spacing="10" IsVisible="False">
                        <Label Text="Ð”Ð¾Ð´Ð°Ñ‚Ð¸ Ð°Ð´Ñ€ÐµÑÑƒ Ð¿Ñ€Ð¸Ñ‚ÑƒÐ»ÐºÑƒ"
                               FontSize="22"
                               FontAttributes="Bold"
                               TextColor="Black"
                               Margin="0,0,0,6"/>

                        <Entry x:Name="NameEntry" Placeholder="ÐÐ°Ð·Ð²Ð° Ð¿Ñ€Ð¸Ñ‚ÑƒÐ»ÐºÑƒ"/>
                        <Entry x:Name="AddressEntry" Placeholder="ÐÐ´Ñ€ÐµÑÐ°"/>
                        <Entry x:Name="PhoneEntry" Placeholder="Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½ +380" Keyboard="Telephone"/>

                        <Button Text="Ð—Ð±ÐµÑ€ÐµÐ³Ñ‚Ð¸"
                                BackgroundColor="#FFFFD129"
                                TextColor="Black"
                                CornerRadius="8"
                                HeightRequest="40"
                                Clicked="OnAddShelter"/>

                        <BoxView HeightRequest="2" BackgroundColor="#E6E6E6" Margin="0,6,0,0"/>
                    </VerticalStackLayout>

                    <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº ÑÐ¿Ð¸ÑÐºÑƒ -->
                    <Label Text="ÐŸÑ€Ð¸Ñ‚ÑƒÐ»ÐºÐ¸"
                           FontSize="22"
                           FontAttributes="Bold"
                           TextColor="Black"
                           Margin="0,0,0,6"/>

                    <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¿Ñ€Ð¸Ñ‚ÑƒÐ»ÐºÑ–Ð² -->
                    <CollectionView x:Name="ShelterList"
                                    ItemsSource="{Binding Source={x:Reference MapPageRoot}, Path=Shelters}"
                                    SelectionMode="None"
                                    Margin="0,0,6,0">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" ItemSpacing="8"/>
                        </CollectionView.ItemsLayout>

                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border Stroke="#E3E3E3" StrokeThickness="2" BackgroundColor="White" Padding="0">
                                    <Grid Padding="12,10" ColumnDefinitions="*,Auto" ColumnSpacing="8">
                                        <!-- ÐÐ°Ð·Ð²Ð° + Ð°Ð´Ñ€ÐµÑÐ° -->
                                        <VerticalStackLayout>
                                            <Label Text="{Binding shelter_name}"
                                                   FontAttributes="Bold"
                                                   FontSize="18"
                                                   TextColor="Black"/>
                                            <Label Text="{Binding address}"
                                                   FontSize="14"
                                                   TextColor="#555"/>
                                        </VerticalStackLayout>

                                        <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð²Ð¸Ð´Ð°Ð»ÐµÐ½Ð½Ñ (Ð»Ð¸ÑˆÐµ Ð°Ð´Ð¼Ñ–Ð½) -->
                                        <Button Grid.Column="1"
                                                Text="ðŸ—‘"
                                                BackgroundColor="Transparent"
                                                TextColor="Black"
                                                CommandParameter="{Binding Id}"
                                                Clicked="OnDeleteShelter">
                                            <Button.Triggers>
                                                <DataTrigger TargetType="Button"
                                                             Binding="{Binding Source={x:Reference MapPageRoot}, Path=IsAdmin}"
                                                             Value="False">
                                                    <Setter Property="IsVisible" Value="False"/>
                                                </DataTrigger>
                                            </Button.Triggers>
                                        </Button>
                                    </Grid>

                                    <!-- ÐšÐ»Ñ–Ðº Ð¿Ð¾ ÐºÐ°Ñ€Ñ‚Ñ†Ñ– â†’ Ð²Ð¸Ð±Ñ–Ñ€/Ð¿Ñ–Ð´ÑÐ²Ñ–Ñ‡ÐµÐ½Ð½Ñ -->
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer
                                            Command="{Binding Source={x:Reference MapPageRoot}, Path=SelectShelterCommand}"
                                            CommandParameter="{Binding .}"/>
                                    </Border.GestureRecognizers>

                                    <!-- ÐŸÑ–Ð´ÑÐ²Ñ–Ñ‡ÑƒÐ²Ð°Ð½Ð½Ñ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾Ñ— ÐºÐ°Ñ€Ñ‚ÐºÐ¸ -->
                                    <Border.Triggers>
                                        <DataTrigger TargetType="Border" Value="true">
                                            <DataTrigger.Binding>
                                                <MultiBinding Converter="{StaticResource EqualityConverter}">
                                                    <Binding Path="Id"/>
                                                    <Binding Source="{x:Reference MapPageRoot}" Path="SelectedShelterId"/>
                                                </MultiBinding>
                                            </DataTrigger.Binding>
                                            <Setter Property="Stroke" Value="#FF5A5A"/>
                                            <Setter Property="StrokeThickness" Value="2.5"/>
                                        </DataTrigger>
                                    </Border.Triggers>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </ScrollView>

            <!-- ÐŸÑ€Ð°Ð²Ð° Ñ‡Ð°ÑÑ‚Ð¸Ð½Ð°: ÐºÐ°Ñ€Ñ‚Ð° -->
            <Border Grid.Column="1" Stroke="Black" StrokeThickness="1">
                <Grid>
                    <!-- Ð¤Ð¾Ð½ ÐºÐ°Ñ€Ñ‚Ð¸ -->
                    <Image Source="https://pro.lviv.ua/wp-content/uploads/karta-lviv.jpeg"
                           Aspect="AspectFill"/>

                    <!-- Canvas + ÑˆÐ°Ñ€ Ð¿Ñ–Ð½Ñ–Ð² -->
                    <AbsoluteLayout x:Name="MapCanvas"
                                    HorizontalOptions="Fill"
                                    VerticalOptions="Fill">
                        <AbsoluteLayout x:Name="PinsLayer"
                                        HorizontalOptions="Fill"
                                        VerticalOptions="Fill"/>
                    </AbsoluteLayout>

                    <!-- ÐŸÑÐµÐ²Ð´Ð¾-ÐºÐ½Ð¾Ð¿ÐºÐ¸ + / - -->
                    <VerticalStackLayout Spacing="8"
                                         HorizontalOptions="End"
                                         VerticalOptions="End"
                                         Margin="0,0,12,12">
                        <Border WidthRequest="36" HeightRequest="36"
                                Stroke="Black" StrokeThickness="1" BackgroundColor="#F4F4F4">
                            <Label Text="+" FontSize="20" HorizontalOptions="Center" VerticalOptions="Center" TextColor="Black"/>
                        </Border>
                        <Border WidthRequest="36" HeightRequest="36"
                                Stroke="Black" StrokeThickness="1" BackgroundColor="#F4F4F4">
                            <Label Text="âˆ’" FontSize="20" HorizontalOptions="Center" VerticalOptions="Center" TextColor="Black"/>
                        </Border>
                    </VerticalStackLayout>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</ContentPage>
